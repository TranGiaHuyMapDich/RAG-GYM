# ğŸ” HÆ¯á»šNG DáºªN Há»† THá»NG ÄÄ‚NG NHáº¬P/ÄÄ‚NG KÃ

## âœ¨ **Tá»”NG QUAN**

Gym RAG AI bÃ¢y giá» cÃ³ trang Ä‘Äƒng nháº­p/Ä‘Äƒng kÃ½ chuyÃªn nghiá»‡p!

### **TÃ­nh NÄƒng:**
- âœ… Trang login/register Ä‘áº¹p vá»›i UI hiá»‡n Ä‘áº¡i
- âœ… Form Ä‘Äƒng kÃ½ Ä‘áº§y Ä‘á»§ (email, tÃªn, thÃ´ng tin thá»ƒ cháº¥t, má»¥c tiÃªu)
- âœ… Login báº±ng email
- âœ… Remember me
- âœ… Auto redirect sau khi login/register
- âœ… Validation Ä‘áº§y Ä‘á»§
- âœ… Toast notifications
- âœ… Loading states
- âœ… Responsive design

---

## ğŸ¨ **UI COMPONENTS**

### **Trang Auth:**
- ğŸ“„ File: `static/auth.html`
- ğŸ¨ CSS: `static/auth.css`
- ğŸ’» JS: `static/auth.js`

### **Features:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ‹ï¸ Gym RAG AI               â”‚
â”‚   Trá»£ lÃ½ gym thÃ´ng minh vá»›i AI      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ÄÄƒng Nháº­p]  [ÄÄƒng KÃ½]   â† Tabs   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ“§ Email                           â”‚
â”‚  [________________]                 â”‚
â”‚                                     â”‚
â”‚  â˜‘ï¸ Ghi nhá»› Ä‘Äƒng nháº­p               â”‚
â”‚                                     â”‚
â”‚  [ğŸ”“ ÄÄƒng Nháº­p]   â† Button          â”‚
â”‚                                     â”‚
â”‚  ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½ ngay    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ **CÃCH Sá»¬ Dá»¤NG**

### **1. Truy Cáº­p Trang Auth:**

**URL:**
- http://localhost:8000/login
- http://localhost:8000/register

**Hoáº·c tá»« trang chÃ­nh:**
- Click nÃºt "ÄÄƒng Nháº­p" hoáº·c "ÄÄƒng KÃ½" á»Ÿ header

### **2. ÄÄƒng KÃ½:**

**BÆ°á»›c 1:** Click tab "ÄÄƒng KÃ½"

**BÆ°á»›c 2:** Äiá»n form:
```
ThÃ´ng Tin CÆ¡ Báº£n:
  ğŸ“§ Email: example@gmail.com
  ğŸ‘¤ Há» vÃ  TÃªn: Nguyá»…n VÄƒn A

ThÃ´ng Tin Thá»ƒ Cháº¥t:
  ğŸ‚ Tuá»•i: 25
  ğŸ“ Chiá»u cao: 170 cm
  âš–ï¸ CÃ¢n náº·ng: 70 kg

ThÃ´ng Tin Táº­p Luyá»‡n:
  ğŸ’ª Loáº¡i CÆ¡ Thá»ƒ: Mesomorph
  ğŸ“Š TrÃ¬nh Äá»™: Intermediate
  ğŸ¯ Má»¥c TiÃªu: TÄƒng cÆ¡ báº¯p
  ğŸ“… Sá»‘ NgÃ y/Tuáº§n: 4 ngÃ y
```

**BÆ°á»›c 3:** Click "âœ¨ Táº¡o TÃ i Khoáº£n"

**BÆ°á»›c 4:** Tá»± Ä‘á»™ng redirect vá» trang chÃ­nh

### **3. ÄÄƒng Nháº­p:**

**BÆ°á»›c 1:** Click tab "ÄÄƒng Nháº­p"

**BÆ°á»›c 2:** Nháº­p email Ä‘Ã£ Ä‘Äƒng kÃ½

**BÆ°á»›c 3:** (Optional) Check "Ghi nhá»› Ä‘Äƒng nháº­p"

**BÆ°á»›c 4:** Click "ğŸ”“ ÄÄƒng Nháº­p"

**BÆ°á»›c 5:** Tá»± Ä‘á»™ng redirect vá» trang chÃ­nh

---

## ğŸ”§ **API ENDPOINTS**

### **POST /api/users/by-email**

TÃ¬m user theo email (cho login)

**Request:**
```json
{
  "email": "user@example.com"
}
```

**Response (Success):**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "full_name": "Nguyá»…n VÄƒn A",
    "body_type": "mesomorph",
    "fitness_level": "Intermediate",
    ...
  }
}
```

**Response (Not Found):**
```json
{
  "success": false,
  "user": null,
  "message": "User not found"
}
```

### **POST /api/users**

Táº¡o user má»›i (cho register) - ÄÃ£ cÃ³ sáºµn tá»« trÆ°á»›c

**Request:**
```json
{
  "email": "user@example.com",
  "full_name": "Nguyá»…n VÄƒn A",
  "age": 25,
  "height": 170,
  "weight": 70,
  "body_type": "mesomorph",
  "fitness_level": "Intermediate",
  "primary_goal": "muscle_gain",
  "days_per_week": 4
}
```

---

## ğŸ“Š **LUá»’NG HOáº T Äá»˜NG**

### **Register Flow:**

```
User vÃ o /register
    â†“
Äiá»n form
    â†“
Submit form
    â†“
auth.js â†’ POST /api/users
    â†“
app.py â†’ supabase.create_user()
    â†“
Supabase â†’ INSERT INTO users
    â†“
Return user vá»›i UUID
    â†“
auth.js â†’ Save user_id to localStorage
    â†“
Redirect to /
    â†“
Main app â†’ Check localStorage
    â†“
Show: âœ… ÄÃ£ Ä‘Äƒng nháº­p
```

### **Login Flow:**

```
User vÃ o /login
    â†“
Nháº­p email
    â†“
Submit form
    â†“
auth.js â†’ POST /api/users/by-email
    â†“
app.py â†’ supabase.get_user_by_email()
    â†“
Supabase â†’ SELECT FROM users WHERE email = ?
    â†“
Return user (náº¿u tá»“n táº¡i)
    â†“
auth.js â†’ Save user_id to localStorage
    â†“
Redirect to /
    â†“
Main app â†’ Check localStorage
    â†“
Show: âœ… ÄÃ£ Ä‘Äƒng nháº­p
```

---

## ğŸ’¾ **DATA PERSISTENCE**

### **LocalStorage:**

**Keys:**
```javascript
// User ID
localStorage.setItem('userId', 'uuid');

// Remember Me
localStorage.setItem('rememberMe', 'true');

// Session ID
localStorage.setItem('sessionId', 'uuid');
```

**Check on Page Load:**
```javascript
const userId = localStorage.getItem('userId');
if (userId) {
  // Already logged in
  // Redirect to home or show logged in state
}
```

---

## ğŸ¨ **CUSTOMIZATION**

### **Colors (CSS Variables):**

Sá»­a trong `static/auth.css`:

```css
:root {
    --primary-color: #667eea;     /* Purple gradient start */
    --secondary-color: #764ba2;   /* Purple gradient end */
    --success-color: #4ecca3;     /* Green for success */
    --error-color: #ff6b6b;       /* Red for errors */
    --warning-color: #ffc93c;     /* Yellow for warnings */
}
```

### **Background Animation:**

Enable/disable trong `static/auth.css`:

```css
/* Táº¯t animation */
.bg-animation {
    display: none;
}
```

### **Form Fields:**

ThÃªm/bá»›t fields trong `static/auth.html`:

```html
<div class="form-group">
    <label for="new-field">
        <span class="icon">ğŸ†•</span>
        Field Má»›i
    </label>
    <input type="text" id="new-field" placeholder="...">
</div>
```

---

## ğŸ” **SECURITY**

### **Current Implementation:**

**Email-based Login:**
- âœ… No password (simple for demo)
- âœ… Email uniqueness checked by Supabase
- âš ï¸ Not secure for production

**For Production:**

1. **Add Password:**
```javascript
// hash password before sending
const hashedPassword = await bcrypt.hash(password, 10);
```

2. **Add Supabase Auth:**
```javascript
// Use Supabase's built-in authentication
const { data, error } = await supabase.auth.signUp({
  email: email,
  password: password
});
```

3. **Add JWT Tokens:**
```javascript
// Store access token instead of user_id
localStorage.setItem('accessToken', data.session.access_token);
```

4. **Add Session Management:**
```javascript
// Check token expiry
// Refresh token when needed
```

---

## ğŸ› **TROUBLESHOOTING**

### **"Email khÃ´ng tá»“n táº¡i"**

**NguyÃªn nhÃ¢n:**
- Email chÆ°a Ä‘Æ°á»£c Ä‘Äƒng kÃ½
- GÃµ sai email

**Giáº£i phÃ¡p:**
- Click "ÄÄƒng kÃ½ ngay" Ä‘á»ƒ táº¡o tÃ i khoáº£n

### **"Email Ä‘Ã£ tá»“n táº¡i"**

**NguyÃªn nhÃ¢n:**
- Email Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½ trÆ°á»›c Ä‘Ã³

**Giáº£i phÃ¡p:**
- Chuyá»ƒn sang tab "ÄÄƒng Nháº­p"
- Hoáº·c dÃ¹ng email khÃ¡c

### **"Supabase not configured"**

**NguyÃªn nhÃ¢n:**
- ChÆ°a setup Supabase
- File `.env` thiáº¿u hoáº·c sai

**Giáº£i phÃ¡p:**
- Setup Supabase theo `QUICK_SUPABASE_SETUP.txt`
- Kiá»ƒm tra file `.env`

### **KhÃ´ng redirect sau login**

**NguyÃªn nhÃ¢n:**
- JavaScript error
- localStorage bá»‹ block

**Giáº£i phÃ¡p:**
- F12 â†’ Console â†’ Xem errors
- Check browser settings (allow cookies/storage)

---

## ğŸ“± **RESPONSIVE DESIGN**

### **Mobile Support:**

**Breakpoints:**
```css
/* Tablet */
@media (max-width: 768px) {
  .auth-box {
    padding: 30px 20px;
  }
}

/* Mobile */
@media (max-width: 480px) {
  .auth-box {
    padding: 25px 15px;
  }
}
```

**Features:**
- âœ… Auto adjust form width
- âœ… Stack form rows on mobile
- âœ… Larger touch targets
- âœ… Optimized fonts

---

## ğŸ¯ **NEXT FEATURES (Future)**

### **Planned:**

1. **Password Auth:**
   - Add password field
   - Password strength indicator
   - Forgot password flow

2. **Social Login:**
   - Google Login
   - Facebook Login
   - GitHub Login

3. **Profile Pictures:**
   - Upload avatar
   - Gravatar integration

4. **Email Verification:**
   - Send verification email
   - Verify email on signup

5. **2FA (Two-Factor Auth):**
   - SMS verification
   - Authenticator app

---

## ğŸ’¡ **TIPS**

### **Development:**

**Auto-fill for testing:**
```javascript
// Add to auth.js for quick testing
document.getElementById('register-email').value = 'test@gym.com';
document.getElementById('register-name').value = 'Test User';
```

**Skip redirect (for debugging):**
```javascript
// Comment out redirect line
// window.location.href = '/';
```

### **Production:**

**Enable HTTPS:**
```python
# Use production server with SSL
uvicorn app:app --host 0.0.0.0 --port 443 --ssl-keyfile key.pem --ssl-certfile cert.pem
```

**Add Rate Limiting:**
```python
# Limit login attempts
from slowapi import Limiter
limiter = Limiter(key_func=get_remote_address)

@limiter.limit("5/minute")
@app.post("/api/users/by-email")
async def get_user_by_email(...):
    ...
```

---

## ğŸ“Š **FILE STRUCTURE**

```
static/
â”œâ”€â”€ auth.html         # Login/Register page
â”œâ”€â”€ auth.css          # Auth page styling
â”œâ”€â”€ auth.js           # Auth page logic
â”œâ”€â”€ index.html        # Main app (updated with login buttons)
â”œâ”€â”€ script.js         # Main app logic (updated)
â””â”€â”€ styles.css        # Main app styling

Backend:
â”œâ”€â”€ app.py            # Added /login, /register, /api/users/by-email
â””â”€â”€ supabase_client.py # Already has get_user_by_email()
```

---

## âœ… **CHECKLIST**

**Files Created:**
- âœ… `static/auth.html` (Login/Register page)
- âœ… `static/auth.css` (Styling)
- âœ… `static/auth.js` (Logic)
- âœ… `AUTH_SYSTEM_GUIDE.md` (This file)

**Files Updated:**
- âœ… `app.py` (Added auth endpoints)
- âœ… `static/script.js` (Updated login buttons)

**Features Working:**
- âœ… Login page accessible at /login
- âœ… Register page accessible at /register
- âœ… Login by email
- âœ… Registration with full form
- âœ… Auto redirect after login/register
- âœ… LocalStorage persistence
- âœ… Toast notifications
- âœ… Loading states
- âœ… Responsive design

---

## ğŸš€ **GET STARTED**

```bash
# 1. Cháº¡y app
python app.py

# 2. Má»Ÿ browser
http://localhost:8000

# 3. Click "ÄÄƒng KÃ½" á»Ÿ header

# 4. Hoáº·c truy cáº­p trá»±c tiáº¿p
http://localhost:8000/register

# 5. Äiá»n form vÃ  Ä‘Äƒng kÃ½!
```

---

**ğŸ‰ Enjoy your new authentication system! ğŸ”**

*Version: 2.1 - Auth System*  
*Date: October 21, 2025*

