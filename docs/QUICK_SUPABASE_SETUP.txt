╔══════════════════════════════════════════════════════════════════════╗
║                                                                      ║
║         🗄️  HƯỚNG DẪN NHANH CẤU HÌNH SUPABASE                        ║
║                                                                      ║
╚══════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────┐
│  📋 BƯỚC 1: TẠO PROJECT TRÊN SUPABASE                                │
└──────────────────────────────────────────────────────────────────────┘

  1. Vào: https://app.supabase.com
  2. Click "New Project"
  3. Điền:
     - Name: Gym RAG AI
     - Password: (tạo password mạnh)
     - Region: Southeast Asia (Singapore)
  4. Click "Create new project"
  5. Đợi 2-3 phút

┌──────────────────────────────────────────────────────────────────────┐
│  🗄️  BƯỚC 2: TẠO DATABASE (SQL EDITOR)                               │
└──────────────────────────────────────────────────────────────────────┘

  1. Sidebar → SQL Editor → New Query
  2. Copy code SQL này và paste vào:

-- Enable UUID
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Bảng users
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email TEXT UNIQUE NOT NULL,
    full_name TEXT,
    body_type TEXT,
    fitness_level TEXT,
    height DECIMAL(5,2),
    weight DECIMAL(5,2),
    age INTEGER,
    primary_goal TEXT,
    available_equipment JSONB,
    days_per_week INTEGER DEFAULT 3,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Bảng workout_plans
CREATE TABLE workout_plans (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    plan_name TEXT NOT NULL,
    plan_data JSONB NOT NULL,
    is_favorite BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Bảng favorite_exercises
CREATE TABLE favorite_exercises (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    exercise_id TEXT NOT NULL,
    exercise_title TEXT NOT NULL,
    exercise_data JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, exercise_id)
);

-- Bảng chat_history
CREATE TABLE chat_history (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    session_id UUID DEFAULT uuid_generate_v4(),
    user_message TEXT NOT NULL,
    ai_response TEXT NOT NULL,
    exercises_suggested JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_plans_user ON workout_plans(user_id);
CREATE INDEX idx_favorites_user ON favorite_exercises(user_id);
CREATE INDEX idx_chat_user ON chat_history(user_id);

-- RLS
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE workout_plans ENABLE ROW LEVEL SECURITY;
ALTER TABLE favorite_exercises ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_history ENABLE ROW LEVEL SECURITY;

  3. Click RUN hoặc Ctrl+Enter
  4. Kiểm tra Table Editor → Thấy 4 tables

┌──────────────────────────────────────────────────────────────────────┐
│  🔑 BƯỚC 3: LẤY API KEYS                                             │
└──────────────────────────────────────────────────────────────────────┘

  1. Vào: Settings → API
  
  2. Copy PROJECT URL:
     https://abcdefghijk.supabase.co
  
  3. Copy API KEY (anon/public):
     eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

┌──────────────────────────────────────────────────────────────────────┐
│  📝 BƯỚC 4: TẠO FILE .env                                            │
└──────────────────────────────────────────────────────────────────────┘

  1. Trong thư mục dự án, tạo file mới: .env
  
  2. Paste nội dung này (thay YOUR_URL và YOUR_KEY):

SUPABASE_URL=https://abcdefghijk.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

  3. Save file

┌──────────────────────────────────────────────────────────────────────┐
│  ✅ BƯỚC 5: TEST KẾT NỐI                                             │
└──────────────────────────────────────────────────────────────────────┘

  Chạy lệnh:
  
  python supabase_client.py

  Nếu thấy: "✅ Connected to Supabase successfully!"
  → THÀNH CÔNG!

┌──────────────────────────────────────────────────────────────────────┐
│  🎯 SỬ DỤNG TRONG CODE                                               │
└──────────────────────────────────────────────────────────────────────┘

from supabase_client import get_supabase_manager

# Khởi tạo
sb = get_supabase_manager()

# Tạo user
user_data = {
    "email": "test@example.com",
    "full_name": "Nguyễn Văn A",
    "body_type": "mesomorph",
    "fitness_level": "Intermediate",
    "primary_goal": "muscle_gain",
    "height": 170,
    "weight": 70,
    "age": 25
}
result = sb.create_user(user_data)

# Lưu workout plan
plan = sb.save_workout_plan(user_id="uuid", plan_data={...})

# Lưu chat
sb.save_chat(
    user_id="uuid",
    session_id="uuid", 
    user_message="Bài tập ngực",
    ai_response="Đây là..."
)

┌──────────────────────────────────────────────────────────────────────┐
│  ⚠️  LƯU Ý BẢO MẬT                                                   │
└──────────────────────────────────────────────────────────────────────┘

  ❌ KHÔNG commit file .env lên Git
  ✅ File .env đã tự động ignore
  ✅ Chỉ share API anon key (không share service_role key)

┌──────────────────────────────────────────────────────────────────────┐
│  📚 TÀI LIỆU CHI TIẾT                                                │
└──────────────────────────────────────────────────────────────────────┘

  - SUPABASE_SETUP.md: Hướng dẫn đầy đủ
  - supabase_client.py: Code kết nối
  - env.example: Template file .env

╔══════════════════════════════════════════════════════════════════════╗
║                                                                      ║
║                   🎉 CHÚC BẠN CẤU HÌNH THÀNH CÔNG!                   ║
║                                                                      ║
╚══════════════════════════════════════════════════════════════════════╝

